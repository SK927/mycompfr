<?php if ( $newsletter['data'] ): ?>
  <!DOCTYPE HTML PUBLIC "-//W3C//DTD XHTML 1.0 Transitional //EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
  <html xmlns="http://www.w3.org/1999/xhtml" xmlns:v="urn:schemas-microsoft-com:vml" xmlns:o="urn:schemas-microsoft-com:office:office">
    <head>
    <!--[if gte mso 9]>
    <xml>
      <o:OfficeDocumentSettings>
        <o:AllowPNG/>
        <o:PixelsPerInch>96</o:PixelsPerInch>
      </o:OfficeDocumentSettings>
    </xml>
    <![endif]-->
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="x-apple-disable-message-reformatting">
      <link rel="icon" type="image/png" href="assets/img/favicon.ico" />
      <!--[if !mso]><!--><meta http-equiv="X-UA-Compatible" content="IE=edge"><!--<![endif]-->
      <title><?php echo "Newsletter AFS {$newsletter['month']} {$newsletter['year']}" ?></title>
    
      <style type="text/css">
        * {
          -ms-text-size-adjust:100%;
          -webkit-text-size-adjust:none;
          -webkit-text-resize:100%;
          text-resize:100%;
        }
        a{
          outline:none;
          color:#fda50c;
          text-decoration:none;
        }
        a:hover{text-decoration:underline !important;}
        a[x-apple-data-detectors]{
          color:inherit !important;
          text-decoration:none !important;
        }
        .link a{
          color:#fff;
          text-decoration: underline;
        }
        .link a:hover{text-decoration:none !important;}
        .active:hover{opacity:0.8;}
        .active{
          -webkit-transition:all 0.3s ease;
             -moz-transition:all 0.3s ease;
            -ms-transition:all 0.3s ease;
              transition:all 0.3s ease;
        }
        h2{
          margin-bottom:0;
        }
        .footer a{color: #fff;}
        table td{border-collapse:collapse !important; mso-line-height-rule:exactly;}
        .ExternalClass, .ExternalClass a, .ExternalClass span, .ExternalClass b, .ExternalClass br, .ExternalClass p, .ExternalClass div{line-height:inherit;}
        @media only screen and (max-width:500px) {
          /* default style */
          table[class="flexible"]{width:100% !important;}
          *[class="hide"]{
            display:none !important;
            width:0 !important;
            height:0 !important;
            padding:0 !important;
            font-size:0 !important;
            line-height:0 !important;
          }
          td[class="img-flex"] img{width:100% !important; height:auto !important;}
          td[class="aligncenter"]{text-align:center !important;}
          th[class="flex"]{display:block !important; width:100% !important;}
          tr[class="table-holder"]{display:table !important; width:100% !important;}
          th[class="thead"]{display:table-header-group !important; width:100% !important;}
          th[class="tfoot"]{display:table-footer-group !important; width:100% !important;}
          /* custom style */
          td[class="wrapper"]{padding:5px !important;}
          td[class="header"]{padding:30px 10px !important;}
          td[class="header"] *{text-align:center !important;}
          td[class="title"]{
            padding:0 0 30px !important;
            font-size:30px !important;
            line-height:36px !important;
          }
          td[class="frame"]{padding:20px 10px !important;}
          td[class="holder"]{padding:20px 20px 30px !important;}
          td[class="holder"] *{text-align:center !important;}
          td[class="block"]{padding:0 10px 10px !important;}
          td[class="box"]{padding:0 20px 20px !important;}
          td[class="nav"]{line-height:30px !important;}
          td[class="p-30"]{padding:0 0 30px !important;}
          td[class="p-20"]{padding:0 0 20px !important;}
          td[class="p-10"]{padding:0 0 10px !important;}
          td[class="indent-null"]{padding:0 !important;}
          td[class="w-20"]{width:20px !important;}
          td[class="h-auto"]{height:auto !important;}
          td[class="footer"]{padding:25px 10px !important;}
        }
      </style>

    </head>

    <body class="clean-body u_body" style="margin: 0;padding: 0;-webkit-text-size-adjust: 100%;background-color: #ffffff;color: #000000">
      <!--[if IE]><div class="ie-container"><![endif]-->
      <!--[if mso]><div class="mso-container"><![endif]-->
      <table id="u_body" style="border-collapse: collapse;table-layout: fixed;border-spacing: 0;mso-table-lspace: 0pt;mso-table-rspace: 0pt;vertical-align: top;min-width: 320px;Margin: 0 auto;background-color: #ffffff;width:100%" cellpadding="0" cellspacing="0">
        <tbody>
        <tr style="vertical-align: top">
          <td style="word-break: break-word;border-collapse: collapse !important;vertical-align: top">
          <!--[if (mso)|(IE)]><table width="100%" cellpadding="0" cellspacing="0" border="0"><tr><td align="center" style="background-color: #ffffff;"><![endif]-->
            <div class="u-row-container" style="padding: 0px;background-color: #000000">
              <div class="u-row" style="margin: 0 auto;min-width: 320px;max-width: 700px;overflow-wrap: break-word;word-wrap: break-word;word-break: break-word;background-color: transparent;">
                <div style="border-collapse: collapse;display: table;width: 100%;height: 100%;background-color: transparent;">
                  <!--[if (mso)|(IE)]><table width="100%" cellpadding="0" cellspacing="0" border="0"><tr><td style="padding: 0px;background-color: #000000;" align="center"><table cellpadding="0" cellspacing="0" border="0" style="width:700px;"><tr style="background-color: transparent;"><![endif]-->
        
                  <!--[if (mso)|(IE)]><td align="center" width="700" style="width: 700px;padding: 0px;border-top: 0px solid transparent;border-left: 0px solid transparent;border-right: 0px solid transparent;border-bottom: 0px solid transparent;border-radius: 0px;-webkit-border-radius: 0px; -moz-border-radius: 0px;" valign="top"><![endif]-->
                  <div class="u-col u-col-100" style="max-width: 320px;min-width: 700px;display: table-cell;vertical-align: top;">
                    <div style="height: 100%;width: 100% !important;border-radius: 0px;-webkit-border-radius: 0px; -moz-border-radius: 0px;">
                    <!--[if (!mso)&(!IE)]><!-->
                      <div style="box-sizing: border-box; height: 100%; padding: 0px;border-top: 0px solid transparent;border-left: 0px solid transparent;border-right: 0px solid transparent;border-bottom: 0px solid transparent;border-radius: 0px;-webkit-border-radius: 0px; -moz-border-radius: 0px;"><!--<![endif]-->
    
                        <table style="font-family:trebuchet ms,geneva;" role="presentation" cellpadding="0" cellspacing="0" width="100%" border="0">
                          <tbody>
                            <tr>
                              <td style="overflow-wrap:break-word;word-break:break-word;padding:10px;font-family:trebuchet ms,geneva;" align="left"> 
                                <div style="font-size: 14px; color: #ffffff; line-height: 140%; text-align: center; word-wrap: break-word;">
                                  <p style="line-height: 140%; margin:0">L'e-mail ne s'affiche pas correctement ? Cliquez <a style="color: #e67e23;" rel="noopener" href="<? echo "https://{$_SERVER['SERVER_NAME']}/afs/view-newsletter?id={$id}" ?>" target="_blank">ici</a> pour le visualiser dans votre navigateur !</p>
                                </div>
                              </td>
                            </tr>
                          </tbody>
                        </table>
                        <!--[if (!mso)&(!IE)]><!-->
                      </div><!--<![endif]-->
                    </div>
                  </div>
                  <!--[if (mso)|(IE)]></td><![endif]-->
                  <!--[if (mso)|(IE)]></tr></table></td></tr></table><![endif]-->
                </div>
              </div>
            </div>
      
            <div class="u-row-container" style="padding: 0px;background-color: transparent">
              <div class="u-row" style="margin: 0 auto;min-width: 320px;max-width: 700px;overflow-wrap: break-word;word-wrap: break-word;word-break: break-word;background-color: transparent;">
                <div style="border-collapse: collapse;display: table;width: 100%;height: 100%;background-color: transparent;">
                  <!--[if (mso)|(IE)]><table width="100%" cellpadding="0" cellspacing="0" border="0"><tr><td style="padding: 0px;background-color: transparent;" align="center"><table cellpadding="0" cellspacing="0" border="0" style="width:700px;"><tr style="background-color: transparent;"><![endif]-->
        
                  <!--[if (mso)|(IE)]><td align="center" width="700" style="width: 700px;padding: 0px;border-top: 0px solid transparent;border-left: 0px solid transparent;border-right: 0px solid transparent;border-bottom: 0px solid transparent;border-radius: 0px;-webkit-border-radius: 0px; -moz-border-radius: 0px;" valign="top"><![endif]-->

                  <div class="u-col u-col-100" style="max-width: 320px;min-width: 700px;display: table-cell;vertical-align: top;">
                    <div style="height: 100%;width: 100% !important;border-radius: 0px;-webkit-border-radius: 0px; -moz-border-radius: 0px;">
                    <!--[if (!mso)&(!IE)]><!-->
                      <div style="box-sizing: border-box; height: 100%; padding: 0px;border-top: 0px solid transparent;border-left: 0px solid transparent;border-right: 0px solid transparent;border-bottom: 0px solid transparent;border-radius: 0px;-webkit-border-radius: 0px; -moz-border-radius: 0px;"><!--<![endif]-->

                        <?php foreach ( from_pretty_json( $newsletter['data'] ) as $key => $value): ?>
                          <?php $is_section = (! in_array( $key, array( 'intro', 'outro' ) )) ?>
                          <?php $padding = $is_section ? '0 0 10px 0' : ( $key == 'intro' ?  '50px 0 10px 0' : '10px 0 50px 0' ) ?>
                          <?php if ( $is_section ): ?>
                            <table style="font-family:trebuchet ms,geneva;" role="presentation" cellpadding="0" cellspacing="0" width="100%" border="0">
                              <tbody>
                                <tr>
                                  <td style="overflow-wrap:break-word;word-break:break-word;padding:0px;font-family:trebuchet ms,geneva;" align="left">
                                    <div>
                                      <h2 style="padding:10px;background:#558abb;color:white"><?php echo $value['title'] ?></h2>
                                    </div>
                                  </td>
                                </tr>
                              </tbody>
                            </table>
                          <?php endif ?>

                          <table style="font-family:trebuchet ms,geneva;" role="presentation" cellpadding="0" cellspacing="0" width="100%" border="0">
                            <tbody>
                              <tr>
                                <td style="overflow-wrap:break-word;word-break:break-word;padding:<?php echo $padding ?>;font-family:trebuchet ms,geneva;" align="left">
                                  <div style="font-size: 14px; line-height: 140%; text-align: left; word-wrap: break-word;">
                                    <?php $text = $parser->transform( $value['text'] ) ?>
                                    <?php echo $text; ?>
                                  </div>
                                </td>
                              </tr>
                            </tbody>
                          </table>

                        <?php endforeach; ?>

                        <!--[if (!mso)&(!IE)]><!-->
                      </div><!--<![endif]-->
                    </div>
                  </div>
                  <!--[if (mso)|(IE)]></td><![endif]-->
                  <!--[if (mso)|(IE)]></tr></table></td></tr></table><![endif]-->
                </div>
              </div>
            </div>
    
            <div class="u-row-container" style="padding: 0px;background-color: #34495e">
              <div class="u-row" style="margin: 0 auto;min-width: 320px;max-width: 700px;overflow-wrap: break-word;word-wrap: break-word;word-break: break-word;background-color: transparent;">
                <div style="border-collapse: collapse;display: table;width: 100%;height: 100%;background-color: transparent;">
                  <!--[if (mso)|(IE)]><table width="100%" cellpadding="0" cellspacing="0" border="0"><tr><td style="padding: 0px;background-color: #34495e;" align="center"><table cellpadding="0" cellspacing="0" border="0" style="width:700px;"><tr style="background-color: transparent;"><![endif]-->
                  <!--[if (mso)|(IE)]><td align="center" width="700" style="width: 700px;padding: 0px;border-top: 0px solid transparent;border-left: 0px solid transparent;border-right: 0px solid transparent;border-bottom: 0px solid transparent;border-radius: 0px;-webkit-border-radius: 0px; -moz-border-radius: 0px;" valign="top"><![endif]-->
                  <div class="u-col u-col-100" style="max-width: 320px;min-width: 700px;display: table-cell;vertical-align: top;">
                    <div style="height: 100%;width: 100% !important;border-radius: 0px;-webkit-border-radius: 0px; -moz-border-radius: 0px;">
                      <!--[if (!mso)&(!IE)]><!--><div style="box-sizing: border-box; height: 100%; padding: 0px;border-top: 0px solid transparent;border-left: 0px solid transparent;border-right: 0px solid transparent;border-bottom: 0px solid transparent;border-radius: 0px;-webkit-border-radius: 0px; -moz-border-radius: 0px;"><!--<![endif]-->
                      <table style="font-family:trebuchet ms,geneva;" role="presentation" cellpadding="0" cellspacing="0" width="100%" border="0">
                        <tbody>
                          <tr>
                            <td style="overflow-wrap:break-word;word-break:break-word;padding:10px;font-family:trebuchet ms,geneva;" align="left">
                              <div style="font-size: 14px; color: #ffffff; line-height: 140%; text-align: center; word-wrap: break-word;">
                                <p style="line-height: 140%; margin:0">Vous recevez cet e-mail car vous êtes adhérent·e de l'AFS. Si vous souhaitez ne plus recevoir la newsletter, vous pouvez la désactiver sur <a style="color: #e67e23;" rel="noopener" href="https://www.speedcubingfrance.org/profile" target="_blank">votre profil</a>.</p>
                              </div>
                            </td>
                          </tr>
                        </tbody>
                      </table>
                      <!--[if (!mso)&(!IE)]><!--></div><!--<![endif]-->
                      </div>
                    </div>
                    <!--[if (mso)|(IE)]></td><![endif]-->
                    <!--[if (mso)|(IE)]></tr></table></td></tr></table><![endif]-->
                  </div>
                </div>
              </div>
              <!--[if (mso)|(IE)]></td></tr></table><![endif]-->
            </td>
          </tr>
        </tbody>
      </table>
      <!--[if mso]></div><![endif]-->
      <!--[if IE]></div><![endif]-->
    </body>
  </html>
<?php else: ?>
  Cette newsletter n'existe pas !
<?php endif ?>
